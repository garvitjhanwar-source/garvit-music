<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garvit Music</title>
    
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/727/727218.png">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        body { background: #030303; color: white; font-family: 'Roboto', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .top-bar { padding: 15px 20px; background: #121212; display: flex; align-items: center; gap: 20px; border-bottom: 1px solid #333; justify-content: space-between; }
        
        .left-section { display: flex; align-items: center; gap: 20px; flex: 1; }
        .brand { display: flex; align-items: center; gap: 10px; text-decoration: none; color: white; font-weight: bold; font-size: 20px; letter-spacing: -0.5px; }
        .brand img { width: 32px; height: 32px; } 

        /* Search Bar Animation */
        .search-container { position: relative; width: 100%; max-width: 500px; }
        .search-input { width: 100%; padding: 12px; background: #222; border: 1px solid transparent; color: white; border-radius: 25px; font-size: 16px; outline: none; padding-left: 20px; transition: 0.3s; }
        .search-input:focus { background: #000; border-color: #555; box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); }
        .loading-spinner { position: absolute; right: 15px; top: 10px; display: none; }
        
        /* User Profile */
        .user-profile { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; display: none; object-fit: cover; }
        .user-name { font-size: 14px; font-weight: 500; display: none; }
        .logout-btn { background: #222; border: none; color: white; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 12px; display: none; transition: 0.2s; }
        .logout-btn:hover { background: #333; }

        .main-content { flex: 1; overflow-y: auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; padding-bottom: 120px; }
        
        .card { background: #181818; padding: 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .card:hover { background: #282828; transform: translateY(-5px); }
        .card img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 4px; margin-bottom: 10px; background: #333; }
        .card h3 { font-size: 14px; margin: 0 0 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }
        .card p { font-size: 12px; color: #aaa; margin: 0; }
        
        .player-bar { position: fixed; bottom: 0; width: 100%; height: 80px; background: #212121; border-top: 1px solid #333; display: flex; align-items: center; padding: 0 20px; box-sizing: border-box; justify-content: space-between; z-index: 100; }
        .song-info { display: flex; align-items: center; width: 30%; }
        .song-info img { width: 50px; height: 50px; margin-right: 15px; background: #333; border-radius: 4px; }
        .info-text h3 { font-size: 14px; margin: 0; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        .info-text p { font-size: 12px; color: #aaa; margin: 0; }
        .controls { display: flex; flex-direction: column; align-items: center; width: 40%; }
        .buttons { display: flex; align-items: center; gap: 20px; margin-bottom: 5px; }
        .btn { background: none; border: none; color: #ddd; cursor: pointer; transition: 0.2s; }
        .btn:hover { color: white; transform: scale(1.1); }
        .play-btn { background: white; color: black; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .play-btn:hover { transform: scale(1.1); color: black; }
        .progress-area { width: 100%; display: flex; align-items: center; gap: 10px; font-size: 11px; color: #aaa; }
        .progress-bar { flex: 1; height: 4px; background: #444; cursor: pointer; position: relative; border-radius: 2px; }
        .progress-fill { height: 100%; background: white; width: 0%; border-radius: 2px; }
        
        #hidden-player { position: fixed; bottom: 90px; right: 20px; width: 320px; height: 180px; z-index: 50; background: black; border: 2px solid #333; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.6); transition: 0.3s; }
        #hidden-player:hover { width: 360px; height: 202px; border-color: #fff; }

        /* Loader */
        .spinner { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff; width: 16px; height: 16px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="left-section">
            <a href="/" class="brand">
                <img src="https://cdn-icons-png.flaticon.com/512/727/727218.png" alt="Logo">
                Garvit Music
            </a>
            <div class="search-container">
                <input type="text" id="search" class="search-input" placeholder="Search for songs...">
                <div id="loader" class="loading-spinner spinner"></div>
            </div>
        </div>

        <div class="user-profile">
            <div id="g_id_onload"
                 data-client_id="1008834040580-n0hmhrtr6cmho2prg3i992hq5l77lpd7.apps.googleusercontent.com" 
                 data-callback="handleCredentialResponse"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="filled_black" data-text="signin_with" data-size="medium"></div>
            
            <img id="userPic" class="user-avatar" src="">
            <span id="userName" class="user-name"></span>
            <button id="logoutBtn" class="logout-btn" onclick="logout()">Sign Out</button>
        </div>
    </div>

    <div class="main-content" id="results">
        <h2 style="grid-column: 1/-1; text-align: center; margin-top: 50px; color: #444;">Play anything. Instantly.</h2>
    </div>

    <footer class="player-bar">
        <div class="song-info">
            <img id="art" src="">
            <div class="info-text">
                <h3 id="title">Select a song</h3>
                <p id="artist">...</p>
            </div>
        </div>
        <div class="controls">
            <div class="buttons">
                <button class="btn"><i class="material-icons">skip_previous</i></button>
                <button class="btn play-btn" onclick="togglePlay()"><i class="material-icons" id="playIcon">play_arrow</i></button>
                <button class="btn"><i class="material-icons">skip_next</i></button>
            </div>
            <div class="progress-area">
                <span id="curTime">0:00</span>
                <div class="progress-bar" onclick="seek(event)"><div class="progress-fill" id="fill"></div></div>
                <span id="durTime">0:00</span>
            </div>
        </div>
        <div style="width: 30%;"></div>
    </footer>

    <div id="hidden-player"></div>

    <script>
        // --- GOOGLE LOGIN ---
        function handleCredentialResponse(response) {
            const payload = decodeJwtResponse(response.credential);
            document.querySelector('.g_id_signin').style.display = 'none'; 
            
            const pic = document.getElementById('userPic');
            pic.src = payload.picture;
            pic.style.display = 'block';

            const name = document.getElementById('userName');
            name.innerText = payload.given_name; 
            name.style.display = 'block';

            document.getElementById('logoutBtn').style.display = 'block';
        }
        function logout() { location.reload(); }
        function decodeJwtResponse(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            return JSON.parse(decodeURIComponent(window.atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join('')));
        }

        // --- TURBO SEARCH (DIRECT API) ---
        const searchInput = document.getElementById('search');
        const resultsDiv = document.getElementById('results');
        const loader = document.getElementById('loader');
        let timer;

        searchInput.addEventListener('input', (e) => {
            clearTimeout(timer); 
            timer = setTimeout(() => doSearch(e.target.value), 500); // Fast response
        });

        async function doSearch(query) {
            if(!query) return;
            loader.style.display = 'block'; // Show spinner
            
            try {
                // We use Piped API directly - Much faster than scraping via Render
                const res = await fetch(`https://pipedapi.kavin.rocks/search?q=${query}&filter=music_songs`);
                const data = await res.json();
                
                // Convert Piped data to our format
                const songs = data.items.map(item => ({
                    id: item.url.split('v=')[1], // Extract ID from URL
                    title: item.title,
                    artist: item.uploaderName,
                    cover: item.thumbnail
                }));

                render(songs);
            } catch(err) {
                console.error(err);
                resultsDiv.innerHTML = '<p style="text-align:center; width:100%;">Search failed. Try again.</p>';
            }
            loader.style.display = 'none';
        }

        function render(songs) {
            resultsDiv.innerHTML = '';
            songs.forEach(song => {
                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => playSong(song);
                div.innerHTML = `
                    <img src="${song.cover}" onerror="this.src='https://via.placeholder.com/150'">
                    <h3>${song.title}</h3>
                    <p>${song.artist}</p>
                `;
                resultsDiv.appendChild(div);
            });
        }

        // --- YOUTUBE PLAYER ---
        var player, isPlayerReady = false;
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('hidden-player', {
                height: '100%', width: '100%',
                events: { 'onReady': () => isPlayerReady = true, 'onStateChange': onStateChange }
            });
        }
        function onStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                document.getElementById('playIcon').innerText = 'pause'; startLoop();
            } else {
                document.getElementById('playIcon').innerText = 'play_arrow'; stopLoop();
            }
        }
        function playSong(song) {
            if(!isPlayerReady) return;
            document.getElementById('title').innerText = song.title;
            document.getElementById('artist').innerText = song.artist;
            document.getElementById('art').src = song.cover;
            player.loadVideoById(song.id);
            player.playVideo();
        }
        function togglePlay() {
            if(!player) return;
            player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo();
        }
        let interval;
        function startLoop() {
            clearInterval(interval);
            interval = setInterval(() => {
                if(!player || !player.getCurrentTime) return;
                const c = player.getCurrentTime(), d = player.getDuration();
                if(d > 0) {
                    document.getElementById('fill').style.width = (c/d)*100 + '%';
                    document.getElementById('curTime').innerText = fmt(c);
                    document.getElementById('durTime').innerText = fmt(d);
                }
            }, 500);
        }
        function stopLoop() { clearInterval(interval); }
        function fmt(s) { return Math.floor(s/60) + ":" + (Math.floor(s%60)<10?"0":"") + Math.floor(s%60); }
        function seek(e) {
            const rect = e.target.getBoundingClientRect();
            player.seekTo(player.getDuration() * ((e.clientX - rect.left) / rect.width), true);
        }
    </script>
</body>
</html>