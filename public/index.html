<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Garvit Music</title>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { background: #030303; color: white; font-family: 'Roboto', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* HEADER & BRANDING */
        .top-bar { padding: 20px; background: #121212; display: flex; align-items: center; gap: 20px; border-bottom: 1px solid #333; }
        
        /* 2. LOGO STYLE */
        .brand { display: flex; align-items: center; font-size: 22px; font-weight: bold; letter-spacing: -1px; color: white; text-decoration: none; }
        .brand i { color: #ff0000; font-size: 32px; margin-right: 8px; }

        .search-input { flex: 1; max-width: 500px; padding: 12px; background: #222; border: none; color: white; border-radius: 4px; font-size: 16px; outline: none; }
        .search-input:focus { background: #000; border: 1px solid #555; }
        
        .main-content { flex: 1; overflow-y: auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; padding-bottom: 120px; }
        
        .card { background: #181818; padding: 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .card:hover { background: #282828; }
        .card img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 4px; margin-bottom: 10px; background: #333; }
        .card h3 { font-size: 14px; margin: 0 0 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }
        .card p { font-size: 12px; color: #aaa; margin: 0; }
        
        .player-bar { position: fixed; bottom: 0; width: 100%; height: 80px; background: #212121; border-top: 1px solid #333; display: flex; align-items: center; padding: 0 20px; box-sizing: border-box; justify-content: space-between; z-index: 100; }
        
        .song-info { display: flex; align-items: center; width: 30%; }
        .song-info img { width: 50px; height: 50px; margin-right: 15px; background: #333; border-radius: 4px; }
        .info-text h3 { font-size: 14px; margin: 0; margin-bottom: 4px; }
        .info-text p { font-size: 12px; color: #aaa; margin: 0; }

        .controls { display: flex; flex-direction: column; align-items: center; width: 40%; }
        .buttons { display: flex; align-items: center; gap: 20px; margin-bottom: 5px; }
        .btn { background: none; border: none; color: #ddd; cursor: pointer; transition: 0.2s; }
        .btn:hover { color: white; }
        .play-btn { background: white; color: black; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .play-btn:hover { transform: scale(1.1); color: black; }
        
        .progress-area { width: 100%; display: flex; align-items: center; gap: 10px; font-size: 11px; color: #aaa; }
        .progress-bar { flex: 1; height: 4px; background: #444; cursor: pointer; position: relative; border-radius: 2px; }
        .progress-fill { height: 100%; background: white; width: 0%; border-radius: 2px; }
        .progress-bar:hover .progress-fill { background: #ff0000; }

        #hidden-player {
            position: fixed; bottom: 90px; right: 20px; width: 320px; height: 180px;
            z-index: 50; background: black; border: 2px solid #333; border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6); transition: 0.3s;
        }
        #hidden-player:hover { width: 360px; height: 202px; border-color: #fff; }
    </style>
</head>
<body>

    <div class="top-bar">
        <a href="/" class="brand">
            <i class="material-icons">equalizer</i> Garvit Music
        </a>
        <input type="text" id="search" class="search-input" placeholder="Search on Garvit Music...">
        <span id="status" style="color: #aaa; font-size: 14px;"></span>
    </div>

    <div class="main-content" id="results"></div>

    <footer class="player-bar">
        <div class="song-info">
            <img id="art" src="">
            <div class="info-text">
                <h3 id="title">Select a song</h3>
                <p id="artist">...</p>
            </div>
        </div>

        <div class="controls">
            <div class="buttons">
                <button class="btn"><i class="material-icons">skip_previous</i></button>
                <button class="btn play-btn" onclick="togglePlay()">
                    <i class="material-icons" id="playIcon">play_arrow</i>
                </button>
                <button class="btn"><i class="material-icons">skip_next</i></button>
            </div>
            <div class="progress-area">
                <span id="curTime">0:00</span>
                <div class="progress-bar" onclick="seek(event)">
                    <div class="progress-fill" id="fill"></div>
                </div>
                <span id="durTime">0:00</span>
            </div>
        </div>
        <div style="width: 30%;"></div>
    </footer>

    <div id="hidden-player"></div>

    <script>
        var player, isPlayerReady = false;

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('hidden-player', {
                height: '100%', width: '100%',
                events: { 'onReady': onPlayerReady, 'onStateChange': onStateChange }
            });
        }

        function onPlayerReady() { isPlayerReady = true; player.setVolume(100); }
        
        function onStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                document.getElementById('playIcon').innerText = 'pause';
                startLoop();
            } else {
                document.getElementById('playIcon').innerText = 'play_arrow';
                stopLoop();
            }
        }

        // Search Logic
        const searchInput = document.getElementById('search');
        const resultsDiv = document.getElementById('results');
        let timer;

        searchInput.addEventListener('input', (e) => {
            clearTimeout(timer);
            timer = setTimeout(() => doSearch(e.target.value), 800);
        });

        async function doSearch(query) {
            if(!query) return;
            document.getElementById('status').innerText = "Searching...";
            
            try {
                const res = await fetch(`/api/search?q=${query}`);
                const data = await res.json();
                render(data);
                document.getElementById('status').innerText = `Found ${data.length} results`;
            } catch(err) { console.error(err); }
        }

        function render(songs) {
            resultsDiv.innerHTML = '';
            songs.forEach(song => {
                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => playSong(song);
                div.innerHTML = `
                    <img src="${song.cover}" onerror="this.src='https://via.placeholder.com/150'">
                    <h3>${song.title}</h3>
                    <p>${song.artist}</p>
                `;
                resultsDiv.appendChild(div);
            });
        }

        function playSong(song) {
            if(!isPlayerReady) return;
            document.getElementById('title').innerText = song.title;
            document.getElementById('artist').innerText = song.artist;
            document.getElementById('art').src = song.cover;
            player.loadVideoById(song.id);
        }

        function togglePlay() {
            if(!player) return;
            const state = player.getPlayerState();
            if(state === 1) player.pauseVideo();
            else player.playVideo();
        }

        let interval;
        function startLoop() {
            clearInterval(interval);
            interval = setInterval(() => {
                if(!player || !player.getCurrentTime) return;
                const c = player.getCurrentTime();
                const d = player.getDuration();
                if(d > 0) {
                    const p = (c / d) * 100;
                    document.getElementById('fill').style.width = p + '%';
                    document.getElementById('curTime').innerText = fmt(c);
                    document.getElementById('durTime').innerText = fmt(d);
                }
            }, 500);
        }
        function stopLoop() { clearInterval(interval); }
        function fmt(s) { 
            const m = Math.floor(s/60);
            const sec = Math.floor(s%60);
            return m + ":" + (sec < 10 ? "0" : "") + sec;
        }
        function seek(e) {
            const rect = e.target.getBoundingClientRect();
            const p = (e.clientX - rect.left) / rect.width;
            player.seekTo(player.getDuration() * p, true);
        }
    </script>
</body>
</html>